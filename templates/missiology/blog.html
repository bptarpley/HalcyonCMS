{% extends 'missiology/base.html' %}
{% load extras %}

{% block main %}
    <div class="container">
        <div class="row no-gutters">
            <div class="col-12 heading whitesmoke-fore light-gray">
                <img src="/static/missiology/img/doodad-light-gray.png" class="heading-img" style="max-height: 55px;" />
                Blog
            </div>
        </div>

        {% if is_admin or can_blog %}
            <div class="row">
                <div class="col-12">
                    <a href="/blog/create"><span class="oi oi-plus"></span> New post</a>
                </div>
            </div>
        {% endif %}

        {% for post in posts %}
            <div class="row">
                <div class="col-sm-12">
                    <div class="content-block white">
                        <div class="row no-gutters">
                            <div class="col-sm-1">
                                <img src="/static/missiology/img/blog-light-cream.png" class="subheading-img img-fluid">
                            </div>
                            <div class="col-sm-11">
                                <span class="subheading">
                                    {% if is_admin or can_blog %}
                                        {% if not post.published %}
                                            [DRAFT]
                                        {% endif %}
                                    {% endif %}
                                    {{ post.title }}
                                    {% if is_admin or can_blog %}
                                        &nbsp;<a href="/blog/create?post-id={{ post.id }}"><span class="oi oi-pencil"></span></a>
                                    {% endif %}
                                </span>
                            </div>
                        </div>
                        <div class="row no-gutters">
                            <div class="col-sm-1"></div>
                            <div class="col-sm-11 text-byline light-gray-fore">
                                Posted by <a href="#">{{ post.user.get_full_name }}</a> at <a href="#">{{ post.pub_date|datetimeparse }}</a>
                                &nbsp;Tags:
                                {% for tag in post.tags.all %}
                                    <a href="/blog?tag-id={{ tag.id }}">{{ tag.text }}</a>
                                {% endfor %}
                            </div>
                        </div>
                        <div class="row no-gutters">
                            <div class="col-sm-12 text-content black-fore">
                                {{ post.content|safe|truncatewords_html:100 }}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        {% endfor %}
        <div class="row no-gutters">
            <div class="col-12">
                {% if posts.has_previous %}
                    <a href="?page=1">&laquo; first</a>
                    <a href="?page={{ posts.previous_page_number }}">previous</a>
                {% endif %}

                Page {{ posts.number }} of {{ posts.paginator.num_pages }}

                {% if posts.has_next %}
                    <a href="?page={{ posts.next_page_number }}">next</a>
                    <a href="?page={{ posts.paginator.num_pages }}">last &raquo;</a>
                {% endif %}
            </div>
        </div>
    </div>
{% endblock %}